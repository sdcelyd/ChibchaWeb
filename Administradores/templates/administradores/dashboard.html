{% extends 'administradores/base.html' %}
{% load i18n %}
{% block title %}{% trans "Dashboard - Admin Panel" %}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-calendar"></i>{% trans " Este mes" %}
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">{% trans "Esta semana" %}</a></li>
                <li><a class="dropdown-item" href="#">{% trans "Este mes" %}</a></li>
                <li><a class="dropdown-item" href="#">{% trans "Este año" %}</a></li>
            </ul>
        </div>
    </div>
</div>

<!-- Quick Stats Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-chibcha-secondary text-uppercase mb-1">
                            {% trans "Total Clientes" %}
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_clientes|default:0 }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-users fa-2x text-muted"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-chibcha-accent text-uppercase mb-1">
                            {% trans "Clientes Activos" %}
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ clientes_activos|default:0 }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-user-check fa-2x text-muted"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-chibcha-brown text-uppercase mb-1">
                            {% trans "Total Empleados" %}
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_empleados|default:0 }}</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-user-tie fa-2x text-muted"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-chibcha-light text-uppercase mb-1">
                            {% trans "Ingresos Totales" %}
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            ${{ ingresos_totales|floatformat:2|default:"0.00" }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-dollar-sign fa-2x text-muted"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Revenue Chart and Recent Activity -->
<div class="row">
    <!-- Revenue Chart -->
    <div class="col-xl-8 col-lg-7">
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-chibcha-secondary">
                    <i class="fas fa-chart-area"></i>{% trans " Ingresos del Último Mes" %}
                </h6>
            </div>
            <div class="card-body">
                <canvas id="revenueChart" style="height: 300px;"></canvas>
            </div>
        </div>
    </div>

    <!-- Pie Chart -->
    <div class="col-xl-4 col-lg-5">
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-chibcha-secondary">
                    <i class="fas fa-chart-pie"></i> {% trans "Distribución de Usuarios" %}
                </h6>
            </div>
            <div class="card-body">
                <canvas id="userChart" style="height: 300px;"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity and Quick Actions -->
<div class="row mt-4">
    <!-- Recent Activity -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-chibcha-secondary">
                    <i class="fas fa-clock"></i> {% trans "Actividad Reciente" %}
                </h6>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item border-0 px-0">
                        <div class="d-flex align-items-center">
                            <div class="avatar-sm me-3">
                                <span class="avatar-title bg-success rounded-circle">
                                    <i class="fas fa-user-plus"></i>
                                </span>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">{% trans "Nuevo usuario registrado" %}</h6>
                                <small class="text-muted">{% trans "Hace 5 minutos" %}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="list-group-item border-0 px-0">
                        <div class="d-flex align-items-center">
                            <div class="avatar-sm me-3">
                                <span class="avatar-title bg-info rounded-circle">
                                    <i class="fas fa-credit-card"></i>
                                </span>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">{% trans "Nuevo pago procesado" %}</h6>
                                <small class="text-muted">{% trans "Hace 12 minutos" %}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="list-group-item border-0 px-0">
                        <div class="d-flex align-items-center">
                            <div class="avatar-sm me-3">
                                <span class="avatar-title bg-warning rounded-circle">
                                    <i class="fas fa-server"></i>
                                </span>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0">{% trans "Plan actualizado" %}</h6>
                                <small class="text-muted">{% trans "Hace 1 hora" %}</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <a href="#" class="btn btn-outline-secondary btn-sm">{% trans "Ver toda la actividad" %}</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-chibcha-secondary">
                    <i class="fas fa-bolt"></i> {% trans "Acciones Rápidas" %}
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    {% if request.administrador.puede_gestionar_usuarios %}
                    <div class="col-6">
                        <a href="{% url 'administradores:crear_usuario' %}" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus"></i><br>
                            <small>{% trans "Crear Usuario" %}</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'administradores:gestionar_usuarios' %}" class="btn btn-info w-100">
                            <i class="fas fa-users"></i><br>
                            <small>{% trans "Ver Usuarios" %}</small>
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if request.administrador.puede_ver_estadisticas %}
                    <div class="col-6">
                        <a href="{% url 'administradores:estadisticas_pagos' %}" class="btn btn-success w-100">
                            <i class="fas fa-chart-line"></i><br>
                            <small>{% trans "Estadísticas" %}</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'administradores:estadisticas_usuarios' %}" class="btn btn-warning w-100">
                            <i class="fas fa-chart-pie"></i><br>
                            <small>{% trans "Reportes" %}</small>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-chibcha-secondary">
                    <i class="fas fa-server"></i> {% trans "Estado del Sistema" %}
                </h6>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span>{% trans "Servidor Web" %}</span>
                    <span class="badge bg-success">{% trans "Online" %}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span>{% trans "Base de Datos" %}</span>
                    <span class="badge bg-success">{% trans "Online" %}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span>{% trans "Procesamiento de Pagos" %}</span>
                    <span class="badge bg-success">{% trans "Online" %}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span>{% trans "Backups" %}</span>
                    <span class="badge bg-info">{% trans "Programado" %}</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Revenue Chart
const revenueCtx = document.getElementById('revenueChart').getContext('2d');
const revenueChart = new Chart(revenueCtx, {
    type: 'line',
    data: {
        labels: [
                '{% trans "Ene" %}', '{% trans "Feb" %}', '{% trans "Mar" %}',
                '{% trans "Abr" %}', '{% trans "May" %}', '{% trans "Jun" %}', '{% trans "Jul" %}'
            ],
        datasets: [{
            label: '{% trans "Ingresos" %}',
            data: [12000, 19000, 15000, 17000, 22000, 25000, 28000],
            borderColor: 'var(--chibcha-secondary)',
            backgroundColor: 'rgba(108, 55, 31, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '$' + value.toLocaleString();
                    }
                }
            }
        }
    }
});

// User Distribution Chart
const userCtx = document.getElementById('userChart').getContext('2d');
const userChart = new Chart(userCtx, {
    type: 'doughnut',
    data: {
        labels: ['{% trans "Clientes" %}', '{% trans "Empleados" %}', '{% trans "Administradores" %}'],
        datasets: [{
            data: [parseInt("{{ total_clientes|default:'0' }}"), parseInt("{{ total_empleados|default:'0' }}"), 3],
            backgroundColor: ['#007bff', '#28a745', '#ffc107'],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>
{% endblock %}